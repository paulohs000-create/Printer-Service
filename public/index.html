<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Printer Test</title>
    <script src="https://cdn.jsdelivr.net/npm/qz-tray/qz-tray.js"></script>
</head>
<body>

    <h2>Teste Impressão 58mm</h2>
    <button onclick="imprimir()">IMPRIMIR TESTE</button>

    <script>

        async function conectarQZ() {
            if (!qz.websocket.isActive()) {
                await qz.websocket.connect();
                console.log("Conectado ao QZ");
            }
        }

        window.onload = async function() {
            try {
                await conectarQZ();
            } catch (err) {
                console.error("Erro ao conectar QZ:", err);
            }
        };

        async function imprimir() {
            try {

                await conectarQZ();

                // ⚠️ ALTERE AQUI se o nome da impressora for diferente
                const config = qz.configs.create("NOME_EXATO_DA_IMPRESSORA");

                const dataAtual = new Date().toLocaleString("pt-PT");

                const reciboCliente = [
                    '\x1B\x40', // reset

                    '        LOJA TESTE\n',
                    '        VIA CLIENTE\n',
                    '--------------------------\n',
                    'Data: ' + dataAtual + '\n',
                    '--------------------------\n',
                    'Ajuste de barra     10.00€\n',
                    'Ziper               15.00€\n',
                    '--------------------------\n',
                    'TOTAL:              25.00€\n',
                    '\n',
                    'Obrigado!\n',
                    '\n\n\n\n'
                ];

                const reciboLoja = [
                    '\x1B\x40',

                    '        LOJA TESTE\n',
                    '         VIA LOJA\n',
                    '--------------------------\n',
                    'Data: ' + dataAtual + '\n',
                    '--------------------------\n',
                    'Ajuste de barra     10.00€\n',
                    'Ziper               15.00€\n',
                    '--------------------------\n',
                    'TOTAL:              25.00€\n',
                    '\n',
                    'Arquivo Interno\n',
                    '\n\n\n\n'
                ];

                const dados = [
                    ...reciboCliente,
                    '\x1D\x56\x00', // corte 1ª via

                    ...reciboLoja,
                    '\x1D\x56\x00'  // corte 2ª via
                ];

                await qz.print(config, dados);

            } catch (err) {
                alert("Erro ao imprimir: " + err);
            }
        }

    </script>

</body>
</html>
